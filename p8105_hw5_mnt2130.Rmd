---
title: "p8105_hw5_mnt2130"
author: "Mindy Tran"
date: "2022-11-16"
output: github_document
---
```{r setup, include = F}
library(tidyverse)
library(p8105.datasets)
library(httr)
library(viridis)
library(purrr)
knitr::opts_chunk$set(
  fig.width = 6,
  fig.asp = .6,
  out.width = "90%"
)
theme_set(theme_minimal() + theme(legend.position = "bottom"))
options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)
scale_colour_discrete = scale_color_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```
### Problem 1

The code chunk below imports all the individual CSVs contained in the zip file by creating a dataframe that includes all the files in that folder and the path to each file. Next, I `map` over paths and import the data through the  `read_csv` function. Finally, I `unnest` the result of `map`. 

```{r}
full_df = 
  tibble(
    files = list.files("data/zip_data/"),
    path = str_c("data/zip_data/", files)
  ) %>% 
  mutate(data = map(path, read_csv)) %>% 
  unnest(cols = c(data))
```

The result of the previous code chunk is untidy. The data is in wide format instead of long and some important variables are included as parts of other variables. The code chunk below cleans the data using string manipulations on the file, converting from wide to long, and selecting relevant variables. 

```{r}
tidy_df = 
  full_df %>% 
  mutate(
    files = str_replace(files, ".csv", ""),
    group = str_sub(files, 1, 3)) %>% 
  pivot_longer(
    week_1:week_8,
    names_to = "week",
    values_to = "outcome",
    names_prefix = "week_") %>% 
  mutate(week = as.numeric(week)) %>% 
  select(group, subj = files, week, outcome)
```

Next, the following code chunk makes a spaghetti plot showing observations on each subject over time. 

```{r plot}
tidy_df %>% 
  ggplot(aes(x = week, y = outcome, group = subj, color = group)) + 
  geom_point() + 
  geom_path() + 
  facet_grid(~group)
```


